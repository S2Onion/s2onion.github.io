---
layout: post
title: "12 Factor"
date: 2020-03-13
tags: [Cloud]
---

## 12 Factor 란?
- 웹앱 혹은 SaaS(Software As A Service) 앱을 만들기 위한 방법론
  * 선언적(declarative) 설정 자동화
  * OS별 차이를 명확히 하고, 실행환경 사이의 이식성을 극대화
  * 클라우드 플랫폼 배포에 적합
  * 개발환경과 운영환경의 차이를 최소화
  * 지속적인 배포
  * 툴, 아키텍처, 개발 방식을 크게 바꾸지 않고 확장(scale up)

- 공식사이트 The Twelve-Factor App
  * https://12factor.net/ko
  
 

## The Twelve Factors
#### 1. 코드베이스 (Codebase)
- 버전 제어와 추적이 되는 하나의 코스베이스(svn, git)를 개발/스테이징/프로덕션 등 여러 용도의 배포 목적으로 사용
- 애플리케이션과 코드베이스는 1:1 관계
- 애플리케이션은 1개의 코드 베이스를 통해 개발/스테이징/프로덕션 등에 배포
  

#### 2. 종속성 (Dependencies)
- 외부 라이브러리, 패키지 종속성을 명시적으로 선언
- 중속성은 Gemfile, POM 등을 사용하여 준수
- 필요한 모든 라이브러리와 버전을 작성하고, 배포 시 빌드 명령어를 실행
 
#### 3. 설정 (Configuration)
- 설정 정보를 코드에 하드코딩하지 않고, 실행 환경에 저장
- 설정을 환경 변수 (envvars나 env라고도 불림)에 저장하여 사용
- 배포 환경별 설정파일을 작성 및 별도 관리하여 사용
- Spring Cloud Config 사용
  
#### 4. 백엔드 서비스 (Back-end services)
- 리소스는 코드 수정 없이 자유롭게 연결되거나 분리가 가능해야함
- 백엔드 서비스 리소스
  * 네트워크을 통해 이용하는 모든 서비스
  * DB, Cache, SMTP, Messaging/Queueing system
- Config에 백엔드 서비스의 URL이나 Locator를 저장하고, 코드에서는 설정을 읽어서 사용

#### 5. 빌드, 릴리즈, 실행 (Build, Release, Run)
- 코드 베이스는 build > release > run의 단계를 거쳐 배포로 변환되며, 각 단계는 엄격하게 분리
- 빌드 단계는 개발자, 배포 단계는 배포 툴(Tool), 실행 단계는 프로세스 매니저에 의해 진행

#### 6. 프로세스 (Processes)
- 애플리케이션을 하나 혹은 여러개의 무상태(Stateless) 프로세스들로 실행
- 각 애플리케이션은 아무것도 공유하지 않음 (Shared-nothing architecture)
- 유지될 필요가 있는 모든 데이터는 데이터베이스 같은 안정된 백엔드 서비스에 저장
- 짧은 단일 트랙잭션 내에서 캐시로 프로세스의 메모리 공간이나 파일시스템을 사용 가능

#### 7. 포트 바인딩 (Port Binding)
- 포트 바인딩으로 서비스를 공개
- 애플리케이션도 백엔드 서비스처럼 URL을 제공

#### 8. 동시성 (Concurrency)
- 프로세스 모델을 사용해 스케일 아웃(Scale-out, 수평 확장)이 가능

#### 9. 폐기 가능 (Disposability)
- 애플리케이션에 대한 신속한 시작과 효율적인 종료(Graceful shut down)로 견고성 극대화
- Graceful shut down
  * 중요 데이터의 소실 방지
  * 서버로부터 데이터를 전송 받는 도중 클라이언트가 소켓 종료를 시도 하였을 때, 서버와 클라이언트간 I/O 스트림 종료로 인한 데이터 소실을 막기 위해 사용
  * 서버에서 TIME_WAIT가 남는게 아닌, 클라이언트에서 TIME_WAIT가 남도록 하는것이며, 클라이언트가 먼저 소켓 종료 함수를 호출하도록 하는것이 핵심
- 신축성 있는 확장과 코드나 설정의 변화를 빠르게 배포할 수 있음

  
  